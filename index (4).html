
<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gastro-Kolon Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            background-color: #f8fafc; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-user-select: none; 
            user-select: none; 
            overscroll-behavior-y: contain;
        }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .custom-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const TIME_SLOTS = ['09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00'];
        const STORAGE_KEY = 'gastro_kolon_v3_final';

        function App() {
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [patients, setPatients] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : [];
            });
            const [activeSlot, setActiveSlot] = useState(null);

            const today = new Date().toISOString().split('T')[0];
            const isHistory = selectedDate < today;

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(patients));
            }, [patients]);

            const filteredPatients = useMemo(() => patients.filter(p => p.date === selectedDate), [patients, selectedDate]);

            const stats = {
                gastro: filteredPatients.filter(p => p.procedureType === 'Gastro').length,
                kolon: filteredPatients.filter(p => p.procedureType === 'Kolon').length,
                total: filteredPatients.length
            };

            const handleAdd = (type) => {
                const name = document.getElementById('nameInput').value;
                const tel = document.getElementById('telInput').value;
                const notes = document.getElementById('notesInput').value;
                if(!name || !tel) return alert('Xahiş olunur Ad və Telefonu daxil edin!');
                
                const newPatient = {
                    id: Date.now().toString(),
                    fullName: name,
                    phone: tel,
                    notes: notes,
                    procedureType: type,
                    timeSlot: activeSlot,
                    date: selectedDate
                };
                setPatients(prev => [...prev, newPatient]);
                setActiveSlot(null);
            };

            const handleExport = () => {
                const data = JSON.stringify(patients, null, 2);
                const blob = new Blob([data], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `GastroBackup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            const handleImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (Array.isArray(data)) {
                            setPatients(data);
                            alert('Məlumatlar bərpa olundu!');
                        }
                    } catch (err) {
                        alert('Xəta: Fayl düzgün deyil!');
                    }
                };
                reader.readAsText(file);
            };

            return (
                <div className="min-h-screen flex flex-col pb-24 max-w-xl mx-auto bg-slate-50 shadow-xl">
                    {/* Header */}
                    <header className="bg-white p-4 border-b sticky top-0 z-40 shadow-sm">
                        <div className="flex justify-between items-center mb-4">
                            <div>
                                <h1 className="text-xl font-black text-blue-600 tracking-tighter">GASTRO-KOLON PRO</h1>
                                {isHistory && <span className="text-[10px] bg-red-500 text-white px-2 py-0.5 rounded font-black uppercase mt-1 inline-block">Arxiv Rejimi</span>}
                            </div>
                            <input 
                                type="date" 
                                value={selectedDate} 
                                onChange={e => setSelectedDate(e.target.value)} 
                                className={`border-2 p-2 rounded-xl text-sm font-bold ${isHistory ? 'border-red-200 bg-red-50 text-red-600' : 'border-slate-100 bg-slate-50'}`} 
                            />
                        </div>
                        
                        <div className="grid grid-cols-3 gap-2 text-center">
                            <div className="bg-blue-600 p-2 rounded-2xl text-white shadow-md">
                                <p className="text-[9px] font-bold uppercase opacity-80">Gastro</p>
                                <p className="text-lg font-black">{stats.gastro}</p>
                            </div>
                            <div className="bg-emerald-600 p-2 rounded-2xl text-white shadow-md">
                                <p className="text-[9px] font-bold uppercase opacity-80">Kolon</p>
                                <p className="text-lg font-black">{stats.kolon}</p>
                            </div>
                            <div className="bg-slate-800 p-2 rounded-2xl text-white shadow-md">
                                <p className="text-[9px] font-bold uppercase opacity-80">Cəmi</p>
                                <p className="text-lg font-black">{stats.total}</p>
                            </div>
                        </div>
                    </header>

                    {/* Main List */}
                    <main className="p-4 space-y-3">
                        {TIME_SLOTS.map(time => {
                            const p = filteredPatients.find(x => x.timeSlot === time);
                            return (
                                <div 
                                    key={time} 
                                    onClick={() => !p && !isHistory && setActiveSlot(time)} 
                                    className={`p-4 rounded-3xl border-2 transition-all duration-200 ${
                                        p ? (p.procedureType === 'Gastro' ? 'bg-blue-50 border-blue-200 shadow-sm' : 'bg-emerald-50 border-emerald-200 shadow-sm') 
                                        : (isHistory ? 'bg-slate-100 border-slate-200 opacity-50' : 'bg-white border-slate-100 active:scale-95')
                                    }`}
                                >
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center gap-4 min-w-0">
                                            <span className={`text-xl font-black ${p ? 'text-slate-800' : 'text-slate-200'}`}>{time}</span>
                                            {p ? (
                                                <div className="min-w-0">
                                                    <p className="font-black text-slate-900 truncate text-base">{p.fullName}</p>
                                                    <div className="flex items-center gap-2 mt-0.5">
                                                        <span className={`text-[9px] font-black uppercase px-2 py-0.5 rounded-full text-white ${p.procedureType === 'Gastro' ? 'bg-blue-500' : 'bg-emerald-500'}`}>
                                                            {p.procedureType}
                                                        </span>
                                                        <span className="text-xs font-bold text-slate-400">{p.phone}</span>
                                                    </div>
                                                </div>
                                            ) : (
                                                <span className="text-sm font-bold text-slate-200 uppercase tracking-widest italic">{isHistory ? 'Yazı yoxdur' : 'Sərbəst'}</span>
                                            )}
                                        </div>
                                        {p && (
                                            <div className="flex gap-2 shrink-0">
                                                <a href={`tel:${p.phone}`} className="w-10 h-10 bg-white rounded-2xl shadow-sm flex items-center justify-center text-blue-600 border border-blue-50 active:bg-blue-50">
                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                                                </a>
                                                {!isHistory && (
                                                    <button onClick={(e) => { e.stopPropagation(); if(confirm('Bu qeydi silmək istəyirsiniz?')) setPatients(prev => prev.filter(x => x.id !== p.id)) }} className="w-10 h-10 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center active:bg-red-100">
                                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                                                    </button>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                    {p?.notes && <p className="mt-3 text-[11px] bg-black/5 p-3 rounded-2xl italic text-slate-600 leading-tight">Qeyd: {p.notes}</p>}
                                </div>
                            );
                        })}
                    </main>

                    {/* Bottom Nav */}
                    <nav className="fixed bottom-0 w-full max-w-xl bg-white/90 backdrop-blur-xl border-t p-4 flex justify-around items-center safe-bottom shadow-2xl z-40">
                        <label className="flex flex-col items-center gap-1 cursor-pointer active:scale-90 transition-transform">
                            <svg className="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                            <span className="text-[9px] font-black uppercase text-slate-400">Geri Yüklə</span>
                            <input type="file" className="hidden" accept=".json" onChange={handleImport} />
                        </label>
                        
                        <button 
                            disabled={isHistory}
                            onClick={() => { const empty = TIME_SLOTS.find(t => !filteredPatients.find(x => x.timeSlot === t)); if(empty) setActiveSlot(empty); }} 
                            className={`w-14 h-14 rounded-3xl -mt-12 shadow-2xl border-4 border-white flex items-center justify-center text-white transition-all ${isHistory ? 'bg-slate-300' : 'bg-blue-600 active:scale-90 active:rotate-90'}`}
                        >
                            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M12 4v16m8-8H4"/></svg>
                        </button>

                        <button onClick={handleExport} className="flex flex-col items-center gap-1 active:scale-90 transition-transform">
                            <svg className="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
                            <span className="text-[9px] font-black uppercase text-slate-400">Yadda Saxla</span>
                        </button>
                    </nav>

                    {/* Registration Modal */}
                    {activeSlot && (
                        <div className="fixed inset-0 bg-slate-900/60 flex items-center justify-center p-4 z-50 backdrop-blur-md">
                            <div className="bg-white w-full max-w-sm rounded-[2.5rem] shadow-2xl overflow-hidden animate-in zoom-in duration-200">
                                <div className="bg-blue-600 p-8 text-white text-center">
                                    <p className="text-[10px] font-black uppercase tracking-widest opacity-60 mb-1">Yeni Qeydiyyat</p>
                                    <h2 className="text-3xl font-black">{activeSlot}</h2>
                                </div>
                                <div className="p-6 space-y-4">
                                    <input id="nameInput" autoFocus placeholder="Xəstə Adı Soyadı" className="w-full p-4 bg-slate-50 rounded-2xl outline-none focus:ring-4 focus:ring-blue-100 font-bold border border-slate-100" />
                                    <input id="telInput" placeholder="Telefon (050...)" type="tel" className="w-full p-4 bg-slate-50 rounded-2xl outline-none focus:ring-4 focus:ring-blue-100 font-bold border border-slate-100" />
                                    <textarea id="notesInput" placeholder="Əlavə qeydlər..." className="w-full p-4 bg-slate-50 rounded-2xl outline-none focus:ring-4 focus:ring-blue-100 resize-none border border-slate-100" rows="2" />
                                    
                                    <div className="flex gap-3 pt-2">
                                        <button onClick={() => handleAdd('Gastro')} className="flex-1 bg-blue-600 text-white p-4 rounded-2xl font-black shadow-lg shadow-blue-200 active:scale-95 transition-all">GASTRO</button>
                                        <button onClick={() => handleAdd('Kolon')} className="flex-1 bg-emerald-600 text-white p-4 rounded-2xl font-black shadow-lg shadow-emerald-200 active:scale-95 transition-all">KOLON</button>
                                    </div>
                                    <button onClick={() => setActiveSlot(null)} className="w-full text-slate-400 font-black text-sm uppercase tracking-widest pt-2">Ləğv et</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
